---
import { componentPageEntries, getComponentEntry, getComponentGlob } from '../../../content';
import MainLayout from "../../../layouts/MainLayout.astro";
import ComponentLayout from "../../../layouts/partials/ComponentPartial.astro";
import { UIPortalInpageNav } from "../../../components/ui-portal-inpage-nav.js";
import { UIPortalCategories } from "../../../components/ui-portal-categories.js";

export async function getStaticPaths() {
  return componentPageEntries.map((entry) => ({    
    params: { 
      component: entry.data.component, 
      // components/component-name/[web,ios,android,design,changelog]
      page: entry.data.platform ? entry.data.platform : 
        ((entry.data.category === 'design' || entry.data.category === 'changelog') ? entry.data.category : null)
    },
    props: { entry }
  }));
}

const { entry } = Astro.props;
let config: any = {
  component: entry.data.component
};
if (entry.data.platform) {
  config.platform = entry.data.platform;
} else if (entry.data.category === 'design' || entry.data.category === 'changelog') {
  config.category = entry.data.category;
} 

const componentEntry = getComponentEntry(config);
const componentGlobs = await Astro.glob('/src/content/docs/components/**/*.md');
const componentGlob = getComponentGlob(componentGlobs, config);
const headers = componentGlob.getHeadings().filter(header => header.depth === 2);
const { Content } = await componentEntry.render();
const inPageNavData = headers.map(header => ({
  name: header.text,
  url: `/${componentEntry.slug}#${header.slug}`
}));
---

<MainLayout title={entry.slug}>
  <ComponentLayout frontmatter={entry.data}>
    <UIPortalCategories entry-data={entry}/>
    <UIPortalInpageNav nav-data={JSON.stringify(inPageNavData)} />
    <Content/>
  </ComponentLayout>
</MainLayout>
  